"use strict";const a=require("./main-C0XUVRMH.js"),H=require("net"),z=require("tls"),F=require("assert"),B=require("http"),T=require("https"),J=require("url");var w={},q={},h={},K=a.commonjsGlobal&&a.commonjsGlobal.__createBinding||(Object.create?function(e,n,t,o){o===void 0&&(o=t);var c=Object.getOwnPropertyDescriptor(n,t);(!c||("get"in c?!n.__esModule:c.writable||c.configurable))&&(c={enumerable:!0,get:function(){return n[t]}}),Object.defineProperty(e,o,c)}:function(e,n,t,o){o===void 0&&(o=t),e[o]=n[t]}),W=a.commonjsGlobal&&a.commonjsGlobal.__setModuleDefault||(Object.create?function(e,n){Object.defineProperty(e,"default",{enumerable:!0,value:n})}:function(e,n){e.default=n}),D=a.commonjsGlobal&&a.commonjsGlobal.__importStar||function(e){if(e&&e.__esModule)return e;var n={};if(e!=null)for(var t in e)t!=="default"&&Object.prototype.hasOwnProperty.call(e,t)&&K(n,e,t);return W(n,e),n};Object.defineProperty(h,"__esModule",{value:!0});h.req=h.json=h.toBuffer=void 0;const Q=D(B),V=D(T);async function R(e){let n=0;const t=[];for await(const o of e)n+=o.length,t.push(o);return Buffer.concat(t,n)}h.toBuffer=R;async function X(e){const t=(await R(e)).toString("utf8");try{return JSON.parse(t)}catch(o){const c=o;throw c.message+=` (input: ${t})`,c}}h.json=X;function Y(e,n={}){const o=((typeof e=="string"?e:e.href).startsWith("https:")?V:Q).request(e,n),c=new Promise((f,d)=>{o.once("response",f).once("error",d).end()});return o.then=c.then.bind(c),o}h.req=Y;(function(e){var n=a.commonjsGlobal&&a.commonjsGlobal.__createBinding||(Object.create?function(i,r,s,u){u===void 0&&(u=s);var l=Object.getOwnPropertyDescriptor(r,s);(!l||("get"in l?!r.__esModule:l.writable||l.configurable))&&(l={enumerable:!0,get:function(){return r[s]}}),Object.defineProperty(i,u,l)}:function(i,r,s,u){u===void 0&&(u=s),i[u]=r[s]}),t=a.commonjsGlobal&&a.commonjsGlobal.__setModuleDefault||(Object.create?function(i,r){Object.defineProperty(i,"default",{enumerable:!0,value:r})}:function(i,r){i.default=r}),o=a.commonjsGlobal&&a.commonjsGlobal.__importStar||function(i){if(i&&i.__esModule)return i;var r={};if(i!=null)for(var s in i)s!=="default"&&Object.prototype.hasOwnProperty.call(i,s)&&n(r,i,s);return t(r,i),r},c=a.commonjsGlobal&&a.commonjsGlobal.__exportStar||function(i,r){for(var s in i)s!=="default"&&!Object.prototype.hasOwnProperty.call(r,s)&&n(r,i,s)};Object.defineProperty(e,"__esModule",{value:!0}),e.Agent=void 0;const f=o(H),d=o(B),_=T;c(h,e);const p=Symbol("AgentBaseInternalState");class y extends d.Agent{constructor(r){super(r),this[p]={}}isSecureEndpoint(r){if(r){if(typeof r.secureEndpoint=="boolean")return r.secureEndpoint;if(typeof r.protocol=="string")return r.protocol==="https:"}const{stack:s}=new Error;return typeof s!="string"?!1:s.split(`
`).some(u=>u.indexOf("(https.js:")!==-1||u.indexOf("node:https:")!==-1)}incrementSockets(r){if(this.maxSockets===1/0&&this.maxTotalSockets===1/0)return null;this.sockets[r]||(this.sockets[r]=[]);const s=new f.Socket({writable:!1});return this.sockets[r].push(s),this.totalSocketCount++,s}decrementSockets(r,s){if(!this.sockets[r]||s===null)return;const u=this.sockets[r],l=u.indexOf(s);l!==-1&&(u.splice(l,1),this.totalSocketCount--,u.length===0&&delete this.sockets[r])}getName(r){return this.isSecureEndpoint(r)?_.Agent.prototype.getName.call(this,r):super.getName(r)}createSocket(r,s,u){const l={...s,secureEndpoint:this.isSecureEndpoint(s)},m=this.getName(l),O=this.incrementSockets(m);Promise.resolve().then(()=>this.connect(r,l)).then(b=>{if(this.decrementSockets(m,O),b instanceof d.Agent)try{return b.addRequest(r,l)}catch(g){return u(g)}this[p].currentSocket=b,super.createSocket(r,s,u)},b=>{this.decrementSockets(m,O),u(b)})}createConnection(){const r=this[p].currentSocket;if(this[p].currentSocket=void 0,!r)throw new Error("No socket was returned in the `connect()` function");return r}get defaultPort(){return this[p].defaultPort??(this.protocol==="https:"?443:80)}set defaultPort(r){this[p]&&(this[p].defaultPort=r)}get protocol(){return this[p].protocol??(this.isSecureEndpoint()?"https:":"http:")}set protocol(r){this[p]&&(this[p].protocol=r)}}e.Agent=y})(q);var $={},Z=a.commonjsGlobal&&a.commonjsGlobal.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty($,"__esModule",{value:!0});$.parseProxyResponse=void 0;const ee=Z(a.srcExports),P=(0,ee.default)("https-proxy-agent:parse-proxy-response");function te(e){return new Promise((n,t)=>{let o=0;const c=[];function f(){const i=e.read();i?y(i):e.once("readable",f)}function d(){e.removeListener("end",_),e.removeListener("error",p),e.removeListener("readable",f)}function _(){d(),P("onend"),t(new Error("Proxy connection ended before receiving CONNECT response"))}function p(i){d(),P("onerror %o",i),t(i)}function y(i){c.push(i),o+=i.length;const r=Buffer.concat(c,o),s=r.indexOf(`\r
\r
`);if(s===-1){P("have not received end of HTTP headers yet..."),f();return}const u=r.slice(0,s).toString("ascii").split(`\r
`),l=u.shift();if(!l)return e.destroy(),t(new Error("No header received from proxy CONNECT response"));const m=l.split(" "),O=+m[1],b=m.slice(2).join(" "),g={};for(const v of u){if(!v)continue;const C=v.indexOf(":");if(C===-1)return e.destroy(),t(new Error(`Invalid header from proxy CONNECT response: "${v}"`));const G=v.slice(0,C).toLowerCase(),E=v.slice(C+1).trimStart(),x=g[G];typeof x=="string"?g[G]=[x,E]:Array.isArray(x)?x.push(E):g[G]=E}P("got proxy server response: %o %o",l,g),d(),n({connect:{statusCode:O,statusText:b,headers:g},buffered:r})}e.on("error",p),e.on("end",_),f()})}$.parseProxyResponse=te;var re=a.commonjsGlobal&&a.commonjsGlobal.__createBinding||(Object.create?function(e,n,t,o){o===void 0&&(o=t);var c=Object.getOwnPropertyDescriptor(n,t);(!c||("get"in c?!n.__esModule:c.writable||c.configurable))&&(c={enumerable:!0,get:function(){return n[t]}}),Object.defineProperty(e,o,c)}:function(e,n,t,o){o===void 0&&(o=t),e[o]=n[t]}),ne=a.commonjsGlobal&&a.commonjsGlobal.__setModuleDefault||(Object.create?function(e,n){Object.defineProperty(e,"default",{enumerable:!0,value:n})}:function(e,n){e.default=n}),I=a.commonjsGlobal&&a.commonjsGlobal.__importStar||function(e){if(e&&e.__esModule)return e;var n={};if(e!=null)for(var t in e)t!=="default"&&Object.prototype.hasOwnProperty.call(e,t)&&re(n,e,t);return ne(n,e),n},L=a.commonjsGlobal&&a.commonjsGlobal.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(w,"__esModule",{value:!0});var k=w.HttpsProxyAgent=void 0;const S=I(H),A=I(z),oe=L(F),se=L(a.srcExports),ce=q,ie=J,ae=$,j=(0,se.default)("https-proxy-agent"),N=e=>e.servername===void 0&&e.host&&!S.isIP(e.host)?{...e,servername:e.host}:e;class U extends ce.Agent{constructor(n,t){super(t),this.options={path:void 0},this.proxy=typeof n=="string"?new ie.URL(n):n,this.proxyHeaders=(t==null?void 0:t.headers)??{},j("Creating new HttpsProxyAgent instance: %o",this.proxy.href);const o=(this.proxy.hostname||this.proxy.host).replace(/^\[|\]$/g,""),c=this.proxy.port?parseInt(this.proxy.port,10):this.proxy.protocol==="https:"?443:80;this.connectOpts={ALPNProtocols:["http/1.1"],...t?M(t,"headers"):null,host:o,port:c}}async connect(n,t){const{proxy:o}=this;if(!t.host)throw new TypeError('No "host" provided');let c;o.protocol==="https:"?(j("Creating `tls.Socket`: %o",this.connectOpts),c=A.connect(N(this.connectOpts))):(j("Creating `net.Socket`: %o",this.connectOpts),c=S.connect(this.connectOpts));const f=typeof this.proxyHeaders=="function"?this.proxyHeaders():{...this.proxyHeaders},d=S.isIPv6(t.host)?`[${t.host}]`:t.host;let _=`CONNECT ${d}:${t.port} HTTP/1.1\r
`;if(o.username||o.password){const s=`${decodeURIComponent(o.username)}:${decodeURIComponent(o.password)}`;f["Proxy-Authorization"]=`Basic ${Buffer.from(s).toString("base64")}`}f.Host=`${d}:${t.port}`,f["Proxy-Connection"]||(f["Proxy-Connection"]=this.keepAlive?"Keep-Alive":"close");for(const s of Object.keys(f))_+=`${s}: ${f[s]}\r
`;const p=(0,ae.parseProxyResponse)(c);c.write(`${_}\r
`);const{connect:y,buffered:i}=await p;if(n.emit("proxyConnect",y),this.emit("proxyConnect",y,n),y.statusCode===200)return n.once("socket",ue),t.secureEndpoint?(j("Upgrading socket connection to TLS"),A.connect({...M(N(t),"host","path","port"),socket:c})):c;c.destroy();const r=new S.Socket({writable:!1});return r.readable=!0,n.once("socket",s=>{j("Replaying proxy buffer for failed request"),(0,oe.default)(s.listenerCount("data")>0),s.push(i),s.push(null)}),r}}U.protocols=["http","https"];k=w.HttpsProxyAgent=U;function ue(e){e.resume()}function M(e,...n){const t={};let o;for(o in e)n.includes(o)||(t[o]=e[o]);return t}const le=Object.freeze(Object.defineProperty({__proto__:null,get HttpsProxyAgent(){return k},default:w},Symbol.toStringTag,{value:"Module"}));exports.index=le;
